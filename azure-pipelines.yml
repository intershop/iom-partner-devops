# see https://developercommunity.visualstudio.com/t/variables-in-yaml-pipeline-are-not-allowing-to-def/812728
parameters:
- name: blueprintInstances
  type: object
  default:
    - dir:           develop
      artifactsFeed: order-iom-releases
    - dir:           ci/blueprint-project/1.3.1
      artifactsFeed: order-iom-releases

trigger:
  branches:
    include:
      - '*'

# see https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#extend-from-a-template
# see https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#use-other-repositories
stages:
- stage: CI
  jobs:
    - ${{ each entry in parameters.blueprintInstances }}:
      - template: ci-job-template.yml
        parameters:
          projectDir:                         ${{ entry.dir }}
          agentPool:                          ubuntu-20.4-DS4_v2-adopt-adoptium-jdk-ora
          artifactsFeed:                      ${{ entry.artifactsFeed }}
          dockerRepoIOMServiceConnection:     order-iom-docker.tools.intershop.com
          dockerRepoIOM:                      docker.tools.intershop.com/iom/intershophub
          acrServiceConnection:               order-iomInternalACR-ISH-ENG-IOM
          acr:                                iominternalacr.azurecr.io
          projectEnvName:                     dev
